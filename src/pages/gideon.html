<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gideon AI - Gelişmiş Yapay Zeka Asistanı</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.2.12/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>

    <style>
        /* DÜZELTME 2: MOBİL UYUMLULUK İÇİN CSS DEĞİŞİKLİKLERİ */
        html, body {
            height: 100%;
            /* overflow: hidden; mobil için kaldırıldı */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        .main-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* height: 100vh yerine min-height */
        }
        /* Masaüstü için eski görünümü koru */
        @media (min-width: 768px) {
            html, body {
                overflow: hidden;
            }
            .main-container {
               height: 100vh;
               min-height: auto;
            }
        }
        /* -- Bitiş: Mobil CSS Değişiklikleri -- */

        .chat-container::-webkit-scrollbar { width: 6px; }
        .chat-container::-webkit-scrollbar-track { background: transparent; }
        .chat-container::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }
        .typing-indicator span {
            height: 8px; width: 8px; background-color: #94a3b8; display: inline-block;
            border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-of-type(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-of-type(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        .prose pre {
            position: relative; background-color: #1e293b !important; padding: 1.5rem 1rem 1rem 1rem;
            border-radius: 0.5rem; overflow-x: auto; font-size: 0.9em;
        }
        .prose pre code { background-color: transparent !important; color: #ccc; }
        .prose code:not(pre *) { background-color: #1e293b; color: #e2e8f0; padding: 0.2em 0.4em; border-radius: 4px; font-size: 90%; }
        .copy-code-btn {
            position: absolute; top: 0.5rem; right: 0.5rem; background-color: #334155;
            color: #cbd5e1; border: none; padding: 0.25rem 0.5rem; font-size: 0.75rem;
            border-radius: 0.375rem; cursor: pointer; opacity: 0.5; transition: opacity 0.2s;
        }
        .prose pre:hover .copy-code-btn { opacity: 1; }
        .suggestion-card { transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out; border: 1px solid #1e293b; }
        .suggestion-card:hover { background-color: #1e293b; transform: translateY(-3px); }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #send-button { transition: background-color 0.2s ease, transform 0.2s ease; }
        #send-button:disabled { background-color: #475569; cursor: not-allowed; transform: scale(0.9); }
        @keyframes flash-icon { 0%, 100% { color: #64748b; } 50% { color: #818cf8; transform: scale(1.2); } }
        .flash { animation: flash-icon 1s ease-in-out; }
    </style>
</head>
<body class="text-slate-300">

    <div class="main-container w-full max-w-4xl mx-auto">
        <header class="flex-shrink-0 p-4 border-b border-slate-800">
             <div class="flex items-center justify-center gap-x-3">
                 <svg class="w-8 h-8 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 21v-1.5M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 002.25-2.25V8.25a2.25 2.25 0 00-2.25-2.25H6.75A2.25 2.25 0 004.5 8.25v7.5a2.25 2.25 0 002.25 2.25z" /></svg>
                 <h1 class="text-xl font-semibold text-slate-300">Gideon AI</h1>
               </div>
        </header>
        
        <main id="content-area" class="flex-grow min-h-0 flex flex-col">
            <div id="welcome-screen" class="flex-grow flex flex-col justify-center items-center p-4">
                <div class="text-center">
                    <h2 class="text-3xl sm:text-5xl font-bold bg-gradient-to-r from-slate-200 to-slate-400 text-transparent bg-clip-text mb-4">Size nasıl yardımcı olabilirim?</h2>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8 w-full max-w-2xl">
                    <div class="suggestion-card bg-slate-900 p-4 rounded-xl cursor-pointer" onclick="setSuggestion('Bir blog yazısı için beyin fırtınası yap')"><p class="font-semibold text-slate-300 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>Blog Yazısı Fikirleri</p><p class="text-sm text-slate-500 mt-1 pl-7">Teknoloji trendleri üzerine beyin fırtınası yap</p></div>
                    <div class="suggestion-card bg-slate-900 p-4 rounded-xl cursor-pointer" onclick="setSuggestion('Bu Python kodunu açıkla')"><p class="font-semibold text-slate-300 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" /></svg> Kod Açıklaması İste</p><p class="text-sm text-slate-500 mt-1 pl-7">Karmaşık bir kod parçasının ne işe yaradığını sor</p></div>
                    <div class="suggestion-card bg-slate-900 p-4 rounded-xl cursor-pointer" onclick="setSuggestion('Haftalık bir yemek planı oluştur')"><p class="font-semibold text-slate-300 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg> Plan Oluştur</p><p class="text-sm text-slate-500 mt-1 pl-7">Sağlıklı ve dengeli bir haftalık yemek listesi hazırla</p></div>
                    <div class="suggestion-card bg-slate-900 p-4 rounded-xl cursor-pointer" onclick="setSuggestion('İstanbul\'da gezilecek tarihi yerleri listele')"><p class="font-semibold text-slate-300 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg> Gezi Tavsiyesi Al</p><p class="text-sm text-slate-500 mt-1 pl-7">Tarihi bir şehir için gezi rotası planla</p></div>
                </div>
            </div>
            <div id="chat-window" class="h-full overflow-y-auto chat-container hidden">
                <div id="message-container" class="p-4 flex flex-col space-y-6"></div>
            </div>
        </main>
        
        <footer class="flex-shrink-0 p-4 sm:pb-6 sm:px-6">
            <div class="w-full">
                <div class="relative">
                    <textarea id="chat-input" placeholder="Gideon AI'a bir soru sorun..." class="w-full max-h-48 bg-slate-800 rounded-2xl p-4 pr-28 border border-slate-700 focus:ring-2 focus:ring-indigo-500/50 focus:outline-none transition-all duration-300 shadow-lg text-slate-200 placeholder-slate-500 text-base resize-none" rows="1"></textarea>
                    <div class="absolute inset-y-0 right-0 flex items-end p-2 gap-2">
                        <button id="deep-research-toggle" title="Derin Araştırma (Web)" class="flex-shrink-0 text-slate-400 hover:text-indigo-400 transition-colors p-2 rounded-full hover:bg-slate-700/50"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg></button>
                        <button id="send-button" class="bg-indigo-600 text-white w-10 h-10 rounded-xl flex items-center justify-center transition-all duration-200 active:scale-95"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2 11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg></button>
                    </div>
                </div>
                <p class="text-center text-xs text-slate-600 mt-3">Gideon AI, Erum AI tarafından geliştirilmiştir. Sonuçlar hatalı veya yanıltıcı olabilir.</p>
            </div>
        </footer>
    </div>

    <script>
        const welcomeScreen = document.getElementById('welcome-screen');
        const chatWindow = document.getElementById('chat-window');
        const messageContainer = document.getElementById('message-container');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const deepResearchToggle = document.getElementById('deep-research-toggle');

        // BU SATIRA KENDİ GEÇERLİ API ANAHTARINIZI YAPIŞTIRMALISINIZ
        const API_KEY = 'AIzaSyBUluWHuRKprchtsCZyYRObfkGSolLtCEQ'; // Sizin orijinal kodunuzdaki anahtar. Lütfen geçerli olanı buraya girin.

        // DEĞİŞTİRİLMEDİ: Sizin çalışan orijinal URL'niz korundu.
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
        
        let isDeepResearchEnabled = false;
        let messageCounter = 0;
        
        // DÜZELTME 1: HAFIZA ÖZELLİĞİ EKLENDİ
        let conversationHistory = [];

        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keydown', (e) => (e.key === 'Enter' && !e.shiftKey) && (e.preventDefault(), sendMessage()));
        chatInput.addEventListener('input', () => {
            chatInput.style.height = 'auto';
            let scrollHeight = chatInput.scrollHeight;
            const maxHeight = 128;
            chatInput.style.height = `${Math.min(scrollHeight, maxHeight)}px`;
            chatInput.style.overflowY = scrollHeight > maxHeight ? 'auto' : 'hidden';
            sendButton.disabled = chatInput.value.trim() === '';
        });
        deepResearchToggle.addEventListener('click', () => {
            isDeepResearchEnabled = !isDeepResearchEnabled;
            deepResearchToggle.classList.toggle('text-indigo-400', isDeepResearchEnabled);
            deepResearchToggle.classList.toggle('text-slate-400', !isDeepResearchEnabled);
        });

        function setSuggestion(text) {
            chatInput.value = text;
            chatInput.focus();
            chatInput.dispatchEvent(new Event('input'));
        }

        function sendMessage() {
            const userMessage = chatInput.value.trim();
            if (userMessage === '') return;
            
            if (welcomeScreen.style.display !== 'none') {
                welcomeScreen.style.display = 'none';
                chatWindow.classList.remove('hidden');
            }
            appendMessage(userMessage, 'user');
            chatInput.value = '';
            chatInput.dispatchEvent(new Event('input'));
            sendButton.disabled = true;
            getAiResponse(userMessage);
        }

        function initializeCopyButtons() {
            const clipboard = new ClipboardJS('.copy-code-btn');
            clipboard.on('success', function(e) {
                const originalText = e.trigger.innerHTML;
                e.trigger.textContent = 'Kopyalandı!';
                setTimeout(() => { e.trigger.innerHTML = originalText; }, 2000);
                e.clearSelection();
            });
            clipboard.on('error', function(e) { e.trigger.textContent = 'Kopyalanamadı!'; });
        }

        function appendMessage(message, sender, isLoading = false) {
            const messageWrapper = document.createElement('div');
            messageWrapper.classList.add('w-full', 'fade-in');
            let messageHTML = '';

            if (sender === 'user') {
                messageWrapper.classList.add('flex', 'justify-end');
                messageHTML = `<div class="flex items-start gap-3 max-w-[85%]"><div class="bg-indigo-600 rounded-2xl rounded-br-lg p-3 text-white shadow-md order-1"><p class="text-base">${message.replace(/\n/g, '<br>')}</p></div><div class="flex-shrink-0 w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center font-semibold border-2 border-slate-600 order-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg></div></div>`;
            } else {
                messageWrapper.classList.add('flex', 'justify-start');
                let contentHTML;
                if (isLoading) {
                    messageWrapper.id = 'loading-indicator-wrapper';
                    contentHTML = `<div class="bg-slate-800 rounded-2xl rounded-tl-lg p-3 typing-indicator"><span></span><span></span><span></span></div>`;
                } else {
                    const renderer = new marked.Renderer();
                    renderer.code = (code, language) => {
                        messageCounter++;
                        const validLanguage = Prism.languages[language] ? language : 'clike';
                        const highlightedCode = Prism.highlight(code, Prism.languages[validLanguage], validLanguage);
                        return `<pre class="language-${validLanguage}"><button class="copy-code-btn" data-clipboard-target="#code-${messageCounter}">Kopyala</button><code id="code-${messageCounter}">${highlightedCode}</code></pre>`;
                    };
                    const renderedHtml = marked.parse(message, { renderer: renderer, breaks: true, gfm: true });
                    contentHTML = `<div class="bg-slate-800 rounded-2xl rounded-tl-lg p-1 shadow-md"><div class="prose prose-invert prose-sm max-w-none text-slate-300 p-3">${renderedHtml}</div></div>`;
                }
                 messageHTML = `<div class="flex items-start gap-3 max-w-[85%]"><div class="flex-shrink-0 w-10 h-10 rounded-full bg-slate-800 border-2 border-slate-700 flex items-center justify-center"><svg class="w-6 h-6 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 21v-1.5M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 002-2.25V8.25a2.25 2.25 0 00-2.25-2.25H6.75A2.25 2.25 0 004.5 8.25v7.5a2.25 2.25 0 002.25 2.25z" /></svg></div>${contentHTML}</div>`;
            }
            
            messageWrapper.innerHTML = messageHTML;
            messageContainer.appendChild(messageWrapper);
            if (!isLoading) { initializeCopyButtons(); }
            chatWindow.scrollTo({ top: chatWindow.scrollHeight, behavior: 'smooth' });
        }

        async function getAiResponse(userMessage) {
            appendMessage('', 'ai', true);
            
            // Kullanıcı mesajını geçmişe ekle
            conversationHistory.push({ role: "user", parts: [{ text: userMessage }] });

            const systemInstructionText = "Senin adın Gideon AI. 'seni kim yaptı', 'geliştiricin kim', 'kime aitsin' gibi sorulara her zaman 'Ben Erum AI tarafından geliştirilen bir yapay zeka modeliyim.' diye cevap ver. Diğer tüm konularda yardımcı ve profesyonel bir asistansın.";
            
            // payload 'contents' kısmı tüm konuşma geçmişini gönderecek şekilde değiştirildi
            const payload = {
                contents: conversationHistory,
                systemInstruction: { parts: [{ text: systemInstructionText }] }
            };

            const researchKeywords = ['kimdir', 'nedir', 'nasıl yapılır', 'nerede', 'ne kadar', 'hangi', 'kaç', 'ne zaman', 'özeti', 'hakkında bilgi', 'fiyatı', 'son durum'];
            const lowerCaseMessage = userMessage.toLowerCase();
            const autoEnableResearch = researchKeywords.some(keyword => lowerCaseMessage.includes(keyword));

            if (isDeepResearchEnabled || autoEnableResearch) {
                payload.tools = [{ "google_search": {} }];
                if (autoEnableResearch && !isDeepResearchEnabled) {
                    deepResearchToggle.classList.add('flash');
                    setTimeout(() => deepResearchToggle.classList.remove('flash'), 1000);
                }
            }
            
            let responseStatus = 0;
            try {
                const response = await fetch(API_URL, { // fetchWithRetry'a gerek yok, orijinali gibi
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                responseStatus = response.status;
                document.getElementById('loading-indicator-wrapper')?.remove();

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("API Hatası Detayları:", errorData);
                    const errorMessage = errorData.error?.message || "API'den geçerli bir hata mesajı alınamadı.";
                    appendMessage(`Üzgünüm, bir hata oluştu. Sunucu cevabı: ${response.status}. Detay: ${errorMessage}`, 'ai');
                    conversationHistory.pop();
                    return;
                }

                const data = await response.json();

                if (data.candidates && data.candidates[0]?.content?.parts[0]?.text) {
                    const aiResponseText = data.candidates[0].content.parts[0].text;
                    appendMessage(aiResponseText, 'ai');
                    // Başarılı AI cevabını geçmişe ekle
                    conversationHistory.push({ role: "model", parts: [{ text: aiResponseText }] });
                } else {
                    console.error("Geçersiz API Cevabı veya Güvenlik Engeli:", data);
                    const blockReason = data.promptFeedback?.blockReason;
                    let feedbackMessage = 'API\'den boş veya geçersiz bir yanıt alındı.';
                    if (blockReason) {
                        feedbackMessage = `İsteğiniz "${blockReason}" nedeniyle engellendi.`;
                    }
                    appendMessage(feedbackMessage, 'ai');
                    conversationHistory.pop();
                }
            } catch (error) {
                console.error("Fetch isteği başarısız oldu:", error);
                document.getElementById('loading-indicator-wrapper')?.remove();
                appendMessage(`Bir ağ hatası oluştu. Lütfen internet bağlantınızı kontrol edin ve tekrar deneyin. Detay: ${error.message}`, 'ai');
                conversationHistory.pop();
            }
        }
        
        // Initial state
        sendButton.disabled = true;
    </script>
    
    <script>
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.addEventListener('keydown', function(event) {
            if ((event.ctrlKey && (event.key === 'u' || event.key === 's' || (event.shiftKey && event.key === 'I'))) || event.key === 'F12') {
                event.preventDefault();
            }
        }, false);
    </script>
</body>
</html>